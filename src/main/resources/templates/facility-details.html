<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title th:text="${facility.getFacility_Name()} + ' | Details'"></title>
  <link rel="stylesheet" th:href="@{/css/style.css}">
  <style>
    body { font-family: 'Helvetica Neue', Arial, sans-serif; background-color: #fafafa; color: #000000; margin: 0; line-height: 1.6; }
    .tab-container { width: 80%; margin: 2rem auto;}
    .tab-links { overflow: hidden; border: 1px solid #ccc; background-color: #f1f1f1; border-radius: 8px 8px 0 0; }
    .tab-links button { background-color: inherit; float: left; border: none; outline: none; cursor: pointer; padding: 14px 16px; transition: 0.3s; font-size: 17px; }
    .tab-links button:hover { background-color: #ddd; }
    .tab-links button.active { background-color: #ccc; }
    .tab-content { display: none; padding: 5px; border: 1px solid #ccc; border-top: none; background: #ffffff; border-radius: 0 0 8px 8px; }
    table { width: 100%; border-collapse: collapse; margin-top: 0.5rem; }
    th, td { padding: 12px; text-align: left; border-bottom: 1px solid #D7CCC8; }
    thead th { background-color: #EFEBE9; font-weight: 600; color: #000000; }
    tbody tr:hover { background-color: #cacaca; }
    h1, h2{
      margin: 5px 0;
      padding: 10px;
    }

    h3{
      margin: 5px 0;
    }



    /* --- Feedback Form Styling --- */
    .feedback-form { margin: 10px; padding: 1rem; background-color: #EFEBE9; border-radius: 8px; }

    /* ✅ ADDED STYLES FOR TITLE AND DESCRIPTION FIELDS */
    .feedback-form input[type="text"],
    .feedback-form textarea {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      font-family: 'Helvetica Neue', Arial, sans-serif;
      font-size: 1rem;
    }

    .feedback-form button { background-color: #ffffff; color: #000000; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
    .feedback-form button:hover { background-color: #c6c6c6; color: white }

    /* --- Star Rating CSS (Cleaned Up) --- */
    .rating { display: inline-block; border: none; }
    .rating > input { display: none; }
    .rating > label {
      color: #ccc;
      float: right;
      font-size: 2.5rem;
      cursor: pointer;
    }
    .rating > label:hover,
    .rating > label:hover ~ label {
      color: #f7d106;
    }
    .rating > input#star1:checked ~ label { color: #E74C3C; } /* Red */
    .rating > input#star2:checked ~ label,
    .rating > input#star3:checked ~ label { color: #F39C12; } /* Orange */
    .rating > input#star4:checked ~ label,
    .rating > input#star5:checked ~ label { color: #2ECC71; } /* Green */

    /* --- Feedback Card Styling --- */
    .feedback-list-container { margin-top: 1rem; }
    .feedback-card { margin: 10px; background-color: #EFEBE9; border: 1px solid #D7CCC8; border-radius: 8px; padding: 1rem; }
    .feedback-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; }
    .feedback-header .user-name { font-weight: bold; color: #272727; }
    .feedback-header .star-rating { font-size: 1.2rem; }
    .feedback-title { margin-top: 0.3rem; margin-bottom: 0.5rem; font-family: 'Georgia', serif; color: #323232; }
    .feedback-description { margin: 0; line-height: 1.5; }
    /* In the <style> tag in facility-details.html */
    a{
      text-decoration: none;
      padding: 10px;

    }

    .alert {
      padding: 15px;
      margin-bottom: 20px;
      border: 1px solid transparent;
      border-radius: 4px;
      transition: opacity 0.5s ease-out; /* ✅ Add this line for the transition */
    }

    /* ✅ Add this new class to make the alert invisible */
    .alert.fade-out {
      opacity: 0;
    }

    .alert-success { color: #155724; background-color: #d4edda; border-color: #c3e6cb; }
    .alert-danger { color: #721c24; background-color: #f8d7da; border-color: #f5c6cb; }
  </style>
</head>
<body>
<div th:replace="~{fragments :: navbar}"></div>

<div class="tab-container">
  <h1 th:text="${facility.getFacility_Name()}">Facility Name</h1>
  <p th:text="${facility.getFacility_Location()}">Facility Location</p>
  <div th:if="${message}" class="alert alert-success" th:text="${message}"></div>
  <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

  <div class="tab-links">
    <button class="tab-link" onclick="openTab(event, 'Issues')" id="defaultOpen">Issue Tracker</button>
    <button class="tab-link" onclick="openTab(event, 'Feedback')">Feedback</button>
  </div>

  <div id="Issues" class="tab-content">
    <h2>Issues</h2>
    <a th:href="@{/facility/{id}/issues/new(id=${facility.getFacility_id()})}" class="btn-primary">
      Report New Issue
    </a>
    <table>
      <thead>
      <tr>
        <th>Title</th>
        <th>Description</th>
        <th>Status</th>
        <th>Priority</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="issue : ${issues}">
        <td>
          <a th:href="@{/issue/{id}(id=${issue.getIssue_id()})}" th:text="${issue.title}"></a>
        </td>
        <td th:text="${issue.description}"></td>
        <td th:text="${issue.status}"></td>
        <td th:text="${issue.priority}"></td>
      </tr>
      </tbody>
    </table>
  </div>

  <div id="Feedback" class="tab-content">
    <h2>Feedback</h2>
    <div class="feedback-form">
      <h3>Post Your Feedback</h3>
      <form th:action="@{/facility/{id}/feedback(id=${facility.getFacility_id()})}" th:object="${newFeedback}" method="post">

        <fieldset class="rating">
          <input type="radio" id="star5" name="rating" value="5" /><label for="star5" title="5 stars">★</label>
          <input type="radio" id="star4" name="rating" value="4" /><label for="star4" title="4 stars">★</label>
          <input type="radio" id="star3" name="rating" value="3" /><label for="star3" title="3 stars">★</label>
          <input type="radio" id="star2" name="rating" value="2" /><label for="star2" title="2 stars">★</label>
          <input type="radio" id="star1" name="rating" value="1" required /><label for="star1" title="1 star">★</label>
        </fieldset>

        <div>
          <label>
            <input type="text" th:field="*{title}" placeholder="Feedback Title" required />
          </label>
        </div>
        <div>
          <label>
            <textarea th:field="*{description}" rows="4" placeholder="Describe your experience..." required></textarea>
          </label>
        </div>

        <button type="submit">Post Feedback</button>
      </form>
    </div>
    <div class="feedback-list-container">
      <div th:each="feedback : ${feedbackList}" class="feedback-card">

        <div class="feedback-header">
          <span class="user-name" th:text="${feedback.user.firstName} + ' ' + ${feedback.user.lastName}">User Name</span>
          <span class="star-rating">
    <span th:each="i : ${#numbers.sequence(1, feedback.rating)}" style="color: #f7d106;">★</span>
    </span>
        </div>

        <h4 class="feedback-title" th:text="${feedback.title}">Feedback Title</h4>

        <p class="feedback-description" th:text="${feedback.description}">
          This is where the full text of the user's review will be displayed.
        </p>
      </div>
    </div>
  </div>
</div>

<script>
  function openTab(evt, tabName) {
    // Hide all tab content
    let tabcontent = document.getElementsByClassName("tab-content");
    for (let i = 0; i < tabcontent.length; i++) {
      tabcontent[i].style.display = "none";
    }

    // Deactivate all tab links
    let tablinks = document.getElementsByClassName("tab-link");
    for (let i = 0; i < tablinks.length; i++) {
      tablinks[i].className = tablinks[i].className.replace(" active", "");
    }

    // Show the selected tab content and activate the link
    document.getElementById(tabName).style.display = "block";
    evt.currentTarget.className += " active";
  }

  // Get the element with id="defaultOpen" and click on it to open the default tab
  document.getElementById("defaultOpen").click();

  document.addEventListener('DOMContentLoaded', function() {

    // Find all elements with the class 'alert'
    const alerts = document.querySelectorAll('.alert');

    alerts.forEach(function(alert) {
      // Set a timer for 10 seconds (10000 milliseconds)
      setTimeout(function() {
        // Add the 'fade-out' class to trigger the CSS transition
        alert.classList.add('fade-out');

        // After the fade-out animation completes (500ms),
        // set display to 'none' to remove it from the page layout
        setTimeout(function() {
          alert.style.display = 'none';
        }, 500);

      }, 10000); // 10-second delay
    });
  });
</script>
<script th:src="@{/js/script.js}"></script>
</body>
</html>