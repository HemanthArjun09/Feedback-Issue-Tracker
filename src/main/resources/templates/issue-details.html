<!DOCTYPE html>
        <html lang="en" xmlns:th="http://www.thymeleaf.org">
        <head>
        <meta charset="UTF-8">
        <title th:text="${issue.title}"></title>
        <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        body { font-family: 'Helvetica Neue', Arial, sans-serif; background-color: #F5F5DC; color: #5D4037; }
        .container { width: 70%; margin: 2rem auto; }
        .issue-details, .comment, .comment-form { background: #FAF0E6; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .comment-header { display: flex; justify-content: space-between; font-size: 0.9em; color: #8D6E63; }
        .admin-comment { border-left: 5px solid #A1887F; }
        textarea { width: 100%; padding: 10px; border-radius: 4px; border: 1px solid #ccc; }
        button { background-color: #A1887F; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; }
        /* In the <style> block of issue-details.html */

        .issue-header {
            display: flex;                 /* Turns on Flexbox layout */
            justify-content: space-between; /* Pushes children to opposite ends */
            align-items: center;           /* Vertically aligns the title and status */
            border-bottom: 1px solid #D7CCC8;
            padding-bottom: 0.5rem;
        }

        .issue-header h1 {
            margin: 0; /* Remove default heading margin */
        }

        .issue-status {
            background-color: #A1887F;
            color: white;
            padding: 5px 15px;
            border-radius: 15px; /* Creates the "pill" shape */
            font-size: 0.9rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .issue-priority {
            /* Optional: Style for the priority label */
            display: inline-block;
            margin-top: 0.5rem;
            font-weight: 500;
            color: #8D6E63;
        }
    </style>
</head>
<body>
<div th:replace="~{fragments :: navbar}"></div>

<div class="issue-details">
    <div class="issue-header">
        <h1 th:text="${issue.title}">Issue Title</h1>

        <div th:if="${userRole == 'ROLE_ADMIN' or userRole == 'FACILITY_USER'}">
            <form id="status-update-form" th:action="@{/issue/{id}/status(id=${issueId})}" method="post">
                <label for="status-dropdown"><select name="status" id="status-dropdown" th:attr="data-original-status=${issue.status}">
                    <option th:each="s : ${allStatuses}"
                            th:value="${s}"
                            th:text="${s.name()}"
                            th:selected="${s == issue.status}">
                    </option>
                </select></label>
            </form>
        </div>
        <div th:if="${userRole == 'ROLE_USER'}">
            <span class="issue-status" th:text="${issue.status.name()}">OPEN</span>
        </div>
    </div>

    Priority: <span class="issue-priority" th:text="${issue.priority}">Priority</span>
    <p th:text="${issue.description}" style="margin-top: 1rem;">Issue description goes here.</p>
</div>

    <div class="comment-form">
        <h3>Leave a Comment</h3>
        <form th:action="@{/issue/{id}/comments(id=${issue.getIssue_id()})}" th:object="${newComment}" method="post">
            <textarea th:field="*{content}" rows="4" placeholder="Write your comment here..." required></textarea>
            <br/><br/>
            <button type="submit">Post Comment</button>
        </form>
    </div>

    <h3>Comments</h3>
    <div th:each="comment : ${comments}" th:class="${comment.isAdminComment} ? 'comment admin-comment' : 'comment'">
        <div class="comment-header">
            <strong th:text="${comment.user.firstName}">User Name</strong>
            <span th:text="${#temporals.format(comment.createdAt, 'dd-MMM-yyyy HH:mm')}">Date</span>
        </div>
        <p th:text="${comment.content}">Comment text goes here.</p>
    </div>



<script th:src="@{/js/script.js}"></script>

<script>
    const statusDropdown = document.getElementById('status-dropdown');

    if (statusDropdown) {
        statusDropdown.addEventListener('change', function() {
            const selectedText = this.options[this.selectedIndex].text;
            const originalStatus = this.getAttribute('data-original-status');
            const isConfirmed = confirm('Are you sure you want to change the status to "' + selectedText + '"?');

            if (isConfirmed) {
                document.getElementById('status-update-form').submit();
            } else {
                this.value = originalStatus;
            }
        });
    }
</script>

</body>
</html>