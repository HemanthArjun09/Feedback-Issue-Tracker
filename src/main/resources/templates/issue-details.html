<!DOCTYPE html>
        <html lang="en" xmlns:th="http://www.thymeleaf.org">
        <head>
        <meta charset="UTF-8">
        <title th:text="${issue.title}"></title>
        <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        body { font-family: 'Helvetica Neue', Arial, sans-serif; background-color: #F5F0E1; color: #000000; }
        .container { width: 70%; margin: 2rem auto; }
        .issue-details, .comment, .comment-form { background: #ffffff; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); }
        .comment-header { display: flex; justify-content: space-between; font-size: 0.9em; color: #000000; }
        .admin-comment { border-left: 5px solid #000000; margin : 0.5rem; padding: 0.5rem; }
        textarea { width: 100%; padding: 10px; border-radius: 4px; border: 1px solid #000000; }
        button { background-color: #c5c5c5; color: #000000; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; }

        .issue-header {
            display: flex;                 /* Turns on Flexbox layout */
            justify-content: space-between; /* Pushes children to opposite ends */
            align-items: center;           /* Vertically aligns the title and status */
            border-bottom: 1px solid #D7CCC8;
            padding-bottom: 0.5rem;
        }

        .issue-header h1 {
            margin: 0; /* Remove default heading margin */
        }

        .issue-status {
            background-color: #ffffff;
            color: #020202;
            padding: 5px 15px;
            border-radius: 15px; /* Creates the "pill" shape */
            font-size: 0.9rem;
            font-weight: bold;
            text-transform: uppercase;
        }

        .issue-priority {
            /* Optional: Style for the priority label */
            display: inline-block;
            margin-top: 0.5rem;
            font-weight: 500;
            color: #000000;
        }
        .issue-status{
            background-color: #c5c5c5;
        }
        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid transparent;
            border-radius: 4px;
            /* This is the key for the smooth fade-out */
            transition: opacity 0.5s ease-out;
        }

        .alert-danger {
            color: #721c24;
            background-color: #f8d7da;
            border-color: #f5c6cb;
        }

        /* This class will be added by JavaScript to make the element invisible */
        .alert.fade-out {
            opacity: 0;
        }
    </style>
</head>
<body>
<div th:replace="~{fragments :: navbar}"></div>

<div class="issue-details">
    <div class="issue-header">
        <h1 th:text="${issue.title}">Issue Title</h1>




        <div th:if="${userRole == 'ROLE_ADMIN' or userRole == 'FACILITY_USER'}">
            <div th:if="${error}" id="error-message" class="alert alert-danger" th:text="${error}"></div>
            <form id="status-update-form" th:action="@{/issue/{id}/status(id=${issueId})}" method="post">
                <label for="status-dropdown"><select name="status" id="status-dropdown" th:attr="data-original-status=${issue.status}">
                    <option th:each="s : ${allStatuses}"
                            th:value="${s}"
                            th:text="${s.name()}"
                            th:selected="${s == issue.status}">
                    </option>
                </select></label>
            </form>
        </div>
        <div th:if="${userRole == 'USER'}">
            <span class="issue-status" th:text="${issue.status.name()}">OPEN</span>
        </div>
    </div>

    Priority: <span class="issue-priority" th:text="${issue.priority}">Priority</span>
    <p th:text="${issue.description}" style="margin-top: 1rem;">Issue description goes here.</p>
</div>

    <div class="comment-form">
        <h3>Leave a Comment</h3>
        <form th:action="@{/issue/{id}/comments(id=${issue.getIssue_id()})}" th:object="${newComment}" method="post">
            <textarea th:field="*{content}" rows="4" placeholder="Write your comment here..." required></textarea>
            <br/><br/>
            <button type="submit">Post Comment</button>
        </form>
    </div>

    <h3>Comments</h3>
    <div th:each="comment : ${comments}" th:class="${comment.isAdminComment} ? 'comment admin-comment' : 'comment'">
        <div class="comment-header">
            <strong th:text="${comment.user.firstName}">User Name</strong>
            <span th:text="${#temporals.format(comment.createdAt, 'dd-MMM-yyyy HH:mm')}">Date</span>
        </div>
        <p th:text="${comment.content}">Comment text goes here.</p>
    </div>



<script th:src="@{/js/script.js}"></script>

<script>
    const statusDropdown = document.getElementById('status-dropdown');

    if (statusDropdown) {
        statusDropdown.addEventListener('change', function() {
            const selectedText = this.options[this.selectedIndex].text;
            const originalStatus = this.getAttribute('data-original-status');
            const isConfirmed = confirm('Are you sure you want to change the status to "' + selectedText + '"?');

            if (isConfirmed) {
                document.getElementById('status-update-form').submit();
            } else {
                this.value = originalStatus;
            }
        });
    }

        document.addEventListener('DOMContentLoaded', function() {
        // Find the error message element by its ID
        const errorMessage = document.getElementById('error-message');

        // Check if the element exists on the page
        if (errorMessage) {
        // Set a timer for 5 seconds (5000 milliseconds)
        setTimeout(function() {
        // Add the 'fade-out' class to trigger the CSS transition
        errorMessage.classList.add('fade-out');

        // After the fade-out animation completes (500ms),
        // set display to 'none' to remove it from the page layout
        setTimeout(function() {
        errorMessage.style.display = 'none';
    }, 500); // This delay should match your CSS transition time

    }, 5000); // 5-second delay
    }
    });

</script>

</body>
</html>